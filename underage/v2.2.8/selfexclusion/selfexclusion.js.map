{"version":3,"sources":["../../../../src/selfexclusion/selfexclusion.es6"],"names":["win","timerHandlerForSessionTimeout","loginTime","limits","i18n","settingsData","max_balance","max_turnover","max_losses","max_7day_turnover","max_7day_losses","max_30day_turnover","max_30day_losses","max_open_bets","session_duration_limit","exclude_until","timeout_until_date","timeout_until_time","binary_url_contact","getBinaryUrl","trimString","event","scope","$el","target","decimals","currencyFractionalDigits","length","attr","r","RegExp","val","toString","match","field","update","data","message","time_out","time","add","format","console","log","isAfter","push","timeout_until","unix","$","each","index","value","set","moment","utc","isBefore","startOf","indexOf","name","limit","undefined","forEach","msg","i","growl","error","confirm","window","liveapi","send","then","response","notice","logoutBasedOnExcludeDateAndTimeOut","setOrRefreshTimer","catch","err","init_win","require","Promise","res","div","html","find","datepicker","dateFormat","minDate","toDate","maxDate","timepicker","timeFormat","windows","createBlankWindow","title","dialogClass","width","minHeight","height","destroy","appendTo","rv","bind","refreshData","authorize","local_storage","get","accountstatus","recheckStatus","_","defer","valueOf","get_self_exclusion","isUndefined","isNull","isFinite","toNumber","clearTimeout","logoutAfter_ms","now","Math","pow","setTimeout","warning","invalidate","logout","dialog","addClass","events","on","cached","is_virtual","removeClass","init","$menuLink","click","hasClass","moveToTop"],"mappings":"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","file":"selfexclusion.js","sourcesContent":["/**\n * Created by arnab on 4/5/16.\n */\nimport $ from \"jquery\";\nimport windows from \"windows/windows\";\nimport liveapi from \"websockets/binary_websockets\";\nimport _ from \"lodash\";\nimport rv from \"common/rivetsExtra\";\nimport moment from \"moment\";\nimport html from \"text!selfexclusion/selfexclusion.html\";\nimport \"jquery-growl\";\nimport \"common/util\";\nimport accountstatus from 'accountstatus/accountstatus';\n\n\nlet win = null,\n    timerHandlerForSessionTimeout = null,\n    loginTime = null;\nconst limits = {\n    \"max_balance\": {\n        \"limit\": 99999999999999999999,\n        \"set\": false,\n        \"name\": \"Maximum balance\".i18n()\n    },\n    \"max_turnover\": {\n        \"limit\": 99999999999999999999,\n        \"set\": false,\n        \"name\": \"Daily turnover limit\".i18n()\n    },\n    \"max_losses\": {\n        \"limit\": 99999999999999999999,\n        \"set\": false,\n        \"name\": \"Daily limit on losses\".i18n()\n    },\n    \"max_7day_turnover\": {\n        \"limit\": 99999999999999999999,\n        \"set\": false,\n        \"name\": \"7-day turnover limit\".i18n()\n    },\n    \"max_7day_losses\": {\n        \"limit\": 99999999999999999999,\n        \"set\": false,\n        \"name\": \"7-day limit on losses\".i18n()\n    },\n    \"max_30day_turnover\": {\n        \"limit\": 99999999999999999999,\n        \"set\": false,\n        \"name\": \"30-day turnover limit\".i18n()\n    },\n    \"max_30day_losses\": {\n        \"limit\": 99999999999999999999,\n        \"set\": false,\n        \"name\": \"30-day limit on losses\".i18n()\n    },\n    \"max_open_bets\": {\n        \"limit\": 101,\n        \"set\": false,\n        \"name\": \"Maximum open positions\".i18n()\n    },\n    \"session_duration_limit\": {\n        \"limit\": 60480,\n        \"set\": false,\n        \"name\": \"Session duration limit\".i18n()\n    },\n    \"exclude_until\": {\n        \"limit\": null,\n        \"set\": false,\n        \"name\": \"Exclude time\".i18n()\n    },\n    \"timeout_until\": {\n        \"limit\": null,\n        \"set\": false,\n        \"name\": \"Time out until\".i18n()\n    }\n};\n\nconst settingsData = {\n    max_balance: null,\n    max_turnover: null,\n    max_losses: null,\n    max_7day_turnover: null,\n    max_7day_losses: null,\n    max_30day_turnover: null,\n    max_30day_losses: null,\n    max_open_bets: null,\n    session_duration_limit: null,\n    exclude_until: null,\n    timeout_until_date: null,\n    timeout_until_time: null,\n    binary_url_contact: getBinaryUrl('contact.html'),\n    trimString: (event, scope) => {\n        const $el = $(event.target),\n            decimals = currencyFractionalDigits(),\n            length = $el.attr('maxlength'),\n            r = new RegExp(`[\\\\d]{0,20}(\\\\.[\\\\d]{1,${decimals}})?`, \"g\"),\n            val = ($el.val().toString().match(r) || [])[0],\n            field = $el.attr('rv-value');\n        scope[field] = val;\n    },\n    update: function(event, scope) {\n\n        const data = { \"set_self_exclusion\": 1 };\n        let message = [];\n\n        if (scope.timeout_until_date) {\n\n            const time_out = moment(scope.timeout_until_date);\n            if (scope.timeout_until_time) {\n                const time = moment(scope.timeout_until_time, \"HH:mm\");\n                time_out.add(time.format('HH'), 'hours')\n                    .add(time.format('mm'), 'minutes');\n                console.log(time_out, time.format('HH'),time.format('mm'));\n            }\n            if (time_out.isAfter(moment().add(6, \"weeks\"))) {\n                message.push(\"Please enter a value less than 6 weeks for time out until.\".i18n());\n            }\n            if (!time_out.isAfter(moment())) {\n                message.push(\"Exclude time must be after today.\".i18n());\n            }\n            scope.timeout_until = time_out.unix();\n        } else {\n            if (scope.timeout_until_time) {\n                message.push(\"Please select a date for time out until.\".i18n());\n            }\n        }\n\n\n        //validation\n        $.each(limits, function(index, value) {\n            scope[index] = scope[index] && scope[index].toString();\n            if (scope[index] || value.set) {\n                if (index === \"exclude_until\") {\n                    if(moment.utc(scope.exclude_until, \"YYYY-MM-DD\").isBefore(moment.utc().startOf('day').add(6, \"months\"))){\n                        message.push(\"Exclude until time cannot be less than 6 months.\".i18n());\n                        return;\n                    }\n                    if(moment.utc(scope.exclude_until, \"YYYY-MM-DD\").isAfter(moment.utc().startOf('day').add(5, \"years\"))){\n                        message.push(\"Exclude until time cannot be more than 5 years.\".i18n());\n                        return;\n                    }\n                }\n                if(scope[index] && scope[index].indexOf(\"e\")!==-1) {\n                    message.push(\"Please enter a valid value for \".i18n() + value.name);\n                    return;\n                }\n                if (!scope[index] || scope[index] <= 0 || (value.limit && scope[index] > value.limit)) {\n                    message.push(\"Please enter a value between 0 and \".i18n() + value.limit + \" for \".i18n() + value.name);\n                    return;\n                }\n\n                data[index] = scope[index];\n            } else {\n                scope[index] = undefined;\n            }\n        });\n\n        if (message.length > 0) {\n            message.forEach(function(msg, i) {\n                $.growl.error({ message: msg });\n            })\n            return;\n        }\n        if (data.timeout_until || data.exclude_until) {\n            const confirm = window.confirm('When you click \"Ok\" you will be excluded from trading on the site until the selected date.'.i18n());\n            if (confirm == false) {\n                return;\n            }\n        }\n\n        liveapi.send(data)\n            .then(function(response) {\n                $.growl.notice({ message: 'Your changes have been updated'.i18n() });\n                logoutBasedOnExcludeDateAndTimeOut();\n                setOrRefreshTimer();\n            })\n            .catch(function(err) {\n                $.growl.error({ message: err.message });\n                console.error(err);\n            });\n    }\n};\n\nconst init_win = function() {\n    require([\"css!selfexclusion/selfexclusion.css\"]);\n    return new Promise(function(res) {\n        const div = $(html).i18n();\n        div.find(\".datepicker\").datepicker({\n            dateFormat: 'yy-mm-dd',\n            minDate: moment.utc().toDate(),\n            maxDate: moment.utc().add(6, \"weeks\").toDate()\n        });\n        div.find(\".timepicker\").timepicker({\n            timeFormat: 'HH:MM'\n        });\n        win = windows.createBlankWindow($('<div/>'), {\n            title: 'Self-Exclusion Facilities'.i18n(),\n            dialogClass: 'self-exclusion',\n            width: 900,\n            minHeight: 500,\n            height: 500,\n            'data-authorized': 'true',\n            destroy: function() {\n                win = null;\n            }\n        });\n        div.appendTo(win);\n        rv.bind(div[0], settingsData);\n        refreshData();\n        res();\n    });\n};\n\nfunction logoutBasedOnExcludeDateAndTimeOut() {\n    const authorize = local_storage.get('authorize');\n    if (settingsData.exclude_until) {\n        if (moment.utc(settingsData.exclude_until, 'YYYY-MM-DD').isAfter(moment.utc().startOf('day'))) {\n            local_storage.set('excluded', true);\n            accountstatus.recheckStatus(authorize);\n            _.defer(function() {\n                $.growl.error({ message: 'You have excluded yourself until '.i18n() + settingsData.exclude_until });\n            });\n        }\n    } else if (settingsData.timeout_until) {\n        if (moment.unix(settingsData.timeout_until).isAfter(moment().unix().valueOf())) {\n            local_storage.set('excluded', true);\n            accountstatus.recheckStatus(authorize);\n            $.growl.error({ message: 'You have excluded yourself until '.i18n() + moment.unix(settingsData.timeout_until).utc().format(\"YYYY-MM-DD HH:mm\") + \"GMT\" });\n        }\n    } else {\n        local_storage.set('excluded', false);\n        accountstatus.recheckStatus(authorize);\n    }\n}\n\nconst refreshData = function() {\n    $.growl.notice({ message: 'Loading self-exclusion settings.'.i18n() });\n    return liveapi\n        .send({ get_self_exclusion: 1 })\n        .then(function(response) {\n            if (response.get_self_exclusion) {\n                $.each(limits, function(index, value) {\n                    settingsData[index] = response.get_self_exclusion[index];\n                    if (response.get_self_exclusion[index]) {\n                        limits[index].limit = response.get_self_exclusion[index];\n                        limits[index].set = true;\n                    }\n                });\n\n                logoutBasedOnExcludeDateAndTimeOut();\n            }\n        })\n        .catch(function(err) {\n            $.growl.error({ message: err.message });\n            console.error(err);\n        });\n};\n\nconst setOrRefreshTimer = function() {\n\n    if (_.isUndefined(settingsData.session_duration_limit) || _.isNull(settingsData.session_duration_limit) || !_.isFinite(_.toNumber(settingsData.session_duration_limit))) return;\n\n    if (timerHandlerForSessionTimeout) clearTimeout(timerHandlerForSessionTimeout);\n    let logoutAfter_ms = settingsData.session_duration_limit * 60 * 1000;\n    //reduce time elapsed since login\n    logoutAfter_ms -= _.now() - loginTime;\n    //setTimeout works with 32 bit value. Anything more than that does not work. 32 bit value is around 49 days\n    //User cannot be active on website for 49 days, so we are setting the session time out to 49 days max\n    if (logoutAfter_ms > Math.pow(2, 32)) { logoutAfter_ms = Math.pow(2, 32); }\n    timerHandlerForSessionTimeout = setTimeout(function() {\n        $.growl.warning({ message: 'Logging out because of self-exclusion session time out!'.i18n() });\n        liveapi.invalidate();\n    }, logoutAfter_ms);\n\n};\n\nconst logout = function() {\n    if (win) win.dialog('destroy');\n    win = null;\n    if (timerHandlerForSessionTimeout) clearTimeout(timerHandlerForSessionTimeout)\n    timerHandlerForSessionTimeout = null;\n    loginTime = null;\n    settingsData.max_balance = null;\n    settingsData.max_turnover = null;\n    settingsData.max_losses = null;\n    settingsData.max_7day_turnover = null;\n    settingsData.max_7day_losses = null;\n    settingsData.max_30day_turnover = null;\n    settingsData.max_30day_losses = null;\n    settingsData.max_open_bets = null;\n    settingsData.session_duration_limit = null;\n    settingsData.exclude_until = null;\n    $(\".resources a.selfexclusion\").addClass('disabled');\n};\n\nliveapi.events.on('login', function(data) {\n    liveapi.cached.authorize()\n        .then(function(data) {\n            if (!data.authorize.is_virtual) {\n                loginTime = _.now();\n                refreshData().then(function() {\n                    setOrRefreshTimer();\n                });\n                $(\"#nav-menu a.selfexclusion\").removeClass('disabled');\n            } else {\n                logout();\n            }\n        })\n        .catch(function(err) {\n            logout();\n        });\n});\nliveapi.events.on('logout', logout);\n\nexport const init = function($menuLink) {\n    $menuLink.click(function() {\n        if (!$(this).hasClass('disabled')) {\n            liveapi.cached.authorize()\n                .then(function() {\n                    if (!win) {\n                        init_win().then(function() {\n                            win.dialog('open');\n                        });\n                    } else {\n                        refreshData();\n                        win.moveToTop();\n                    }\n                })\n                .catch(function(err) {\n                    console.error(err);\n                });\n        }\n    });\n}\n\nexport default {\n    init\n}\n"]}